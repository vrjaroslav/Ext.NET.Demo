@{
var X = Html.X();
}

@(X.Panel()
    .ID("TotalOrdersPanel")
    .Title("Total Orders")
    .Layout(LayoutType.Fit)
    .Closable(true)
    .TopBar(X.Toolbar()
        .Items(
            X.DateField()
                .ID("TotalOrdersStartDate")
                .FieldLabel("Start date")
                .Value(DateTime.Now.AddDays(-31)),
            X.DateField()
                .ID("TotalOrdersEndDate")
                .FieldLabel("End date")
                .Value(DateTime.Now),
            X.ToolbarSeparator(),
            X.Button()
                .Text("Reload Data")
                .Icon(Icon.ArrowRefresh)
                .Handler("this.up('panel').down('chart').getStore().load({ params: { startDate: #{TotalOrdersStartDate}.getValue(), endDate: #{TotalOrdersEndDate}.getValue() } } )"),
            X.Button()
                .Text("Save Chart")
                .Icon(Icon.Disk)
                .Handler("saveChart")
        )
    )
    .Items(
        X.Chart()
            .ID("TotalOrdersChart")
            .Animate(true)
            .Store(X.Store()
                .Data(Model)
                .Model(X.Model()
                    .Fields(
                        X.ModelField().Name("Day").Type(ModelFieldType.Date),
                        X.ModelField().Name("OrdersCount").Type(ModelFieldType.Int)
                    )
                )
                .Proxy(X.AjaxProxy()
                    .Url(Url.Action("GetChartData", "Orders"))
                    .Reader(X.JsonReader().Root("data"))
                )
            )
            .Axes(
                X.TimeAxis()
                    .Fields("Day")
                    .Position(Position.Bottom)
                    .Title("Date")
                    .MinorTickSteps(1)
                    .DateFormat("dd MMM")
                    ,
                X.NumericAxis()
                    .Position(Position.Left)
                    .Fields("OrdersCount")
                    .Title("Orders Count")
            )
            .Series(X.LineSeries()
                .Axis(Position.Bottom)
                .Highlight(true)
                .XField("Day")
                .YField("OrdersCount")
                .Tips(X.ChartTip()
                    .TrackMouse(true)
                    .Width(140)
                    .Height(28)
                    .Renderer(r => r.Handler = "this.setTitle(Ext.Date.format(storeItem.get('Day'), 'd M') + ': ' + storeItem.get('OrdersCount') + ' orders');")
                )
            )
    )
)