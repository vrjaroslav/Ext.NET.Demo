@{
var X = Html.X();
}

@(X.Panel()
    .Title("Orders Amount per Month Chart")
    .Layout(LayoutType.Fit)
    .Width(800)
    .Height(600)
    .TopBar(X.Toolbar()
        .Items(
            X.Button()
                .Text("Reload Data")
                .Icon(Icon.ArrowRefresh)
                .Handler("this.up('panel').down('chart').getStore().reload()"),
            X.Button()
                .Text("Save Chart")
                .Icon(Icon.Disk)
                .Handler("saveChart")
        )
    )
    .Items(
        X.Chart()
            .ID("OrdersChart")
            .Animate(true)
            .Store(X.Store()
                .Data(Model)
                .Model(X.Model()
                    .Fields(
                        X.ModelField().Name("Month").Type(ModelFieldType.Int),
                        X.ModelField().Name("OrdersCount").Type(ModelFieldType.Int)
                    )
                )
                .Proxy(X.AjaxProxy()
                    .Url(Url.Action("GetData", "Orders"))
                    .Reader(X.JsonReader().Root("data"))
                )
            )
            .Axes(
                X.NumericAxis()
                    .Fields("Month")
                    .Position(Position.Bottom)
                    .Title("Month")
                    .Minimum(1)
                    .Maximum(12)
                    .MinorTickSteps(1)
                    ,
                X.NumericAxis()
                    .Position(Position.Left)
                    .Fields("OrdersCount")
                    .Title("Orders Count")
            )
            .Series(X.LineSeries()
                .Axis(Position.Bottom)
                .Highlight(true)
                .XField("Month")
                .YField("OrdersCount")
                .Tips(X.ChartTip()
                    .TrackMouse(true)
                    .Width(140)
                    .Height(28)
                    .Renderer(r => r.Handler = "this.setTitle(Ext.Date.getShortMonthName(storeItem.get('Month')) + ': ' + storeItem.get('OrdersCount') + ' orders');")
                )
                //.Label(X.SeriesLabel()
                //    .Display(SeriesLabelDisplay.InsideEnd)
                //    .Field(new [] { "Month" })
                //    .Orientation(Orientation.Horizontal)
                //    .Color("#333")
                //    .TextAnchor("middle")
                //)
            )
    )
)